digraph "" {
    bgcolor="transparent";
    graph [id="doc-flowchart", rankdir=TB, nodesep=0.7, ranksep=0.8, bgcolor="none", splines=ortho];

    // Node Styling
    node [fontname="Verdana", fontsize="16", color="#CFB87C", style="filled", fillcolor="#121212", penwidth="2", fontcolor="white", shape=ellipse];
    edge [color="#CFB87C", fillcolor="#121212", penwidth="1.5", fontsize="14", fontcolor="#CFB87C"];

    // --- ROW 0: The solitary top node ---
    { rank=source; DoSomething; BadnessRed; BehFix;}

    // --- ROW 1: The Start ---
    { rank=same; NS; Exceed; Badness; }

    // --- ROW 5: Branching Outcomes ---
    { rank=same; TooBad; }

    // --- ROW 6: Post-Penalty Actions ---
    { rank=same; DurationEnded; SentEmail; DurationTimer; }

    // Nodes
    NS [label="normal state"]
    Exceed [label="Usage thresholds\nexceeded?", style="filled,dashed"]
    DoSomething [label="If penalty occurrences > 0,\nstart penalty occurrences timer;\n at zero, reduce penalty occurrences\nby 1, repeating until zero.", fontsize="13"]
    Badness [label="Badness accumulates"]
    BehFix [label="Below usage\nthresholds?", style="filled,dashed"]
    TooBad [label="Has badness\nreached 100?", style="filled,dashed"]
    SentEmail [label="Warning email sent, penalty\noccurrences increases by 1,\n penalty state assigned,\nand resources throttled"]
    DurationTimer [label="Penalty duration\ntimer counts down"]
    DurationEnded [label="Has the penalty\nduration ended?", style="filled,dashed"]
    BadnessRed [label="Badness reduces"]

    // Flow Logic
    NS -> Exceed
    NS -> DoSomething 
    
    // Use constraint=false to point UP to the top row without pulling the chart apart
    Exceed -> NS [xlabel="  No", constraint=false]
    Exceed -> Badness [label="Yes"]

    Badness -> BehFix
    Badness -> TooBad
    
    BehFix  -> Badness [xlabel="  No"]
    BehFix  -> BadnessRed [label="Yes", constraint=false]
    TooBad -> Badness [xlabel="No  "]
    TooBad -> SentEmail [xlabel="Yes  "]

    SentEmail -> DurationTimer [constraint=false]
    DurationTimer -> DurationEnded [constraint=false]
    
    DurationEnded -> NS [xlabel="Yes  "]
    DurationEnded -> DurationTimer [xlabel=" No", constraint=false]
    
    BadnessRed -> Exceed
}